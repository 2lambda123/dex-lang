<!DOCTYPE HTML>
<html><head><link rel="stylesheet" href="style.css" type="text/css"><meta charset="UTF-8"></head><body><div id="main-output"><div class="cell"><div class="prose-block"><h2>Dex prelude</h2>
</div></div><div class="cell"><div class="prose-block"><p>Runs before every Dex program unless an alternative is provided with <code>--prelude</code>.</p>
</div></div><div class="cell"><div class="prose-block"><p>Curried wrappers around built-in functions</p>
</div></div><div class="cell"><div class="code-block">iadd <span class="symbol">::</span> <span class="type-name">Int</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Int</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Int</span>
iadd x y <span class="symbol">=</span> %iadd(x, y)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">isub <span class="symbol">::</span> <span class="type-name">Int</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Int</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Int</span>
isub x y <span class="symbol">=</span> %isub(x, y)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">imul <span class="symbol">::</span> <span class="type-name">Int</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Int</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Int</span>
imul x y <span class="symbol">=</span> %imul(x, y)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">rem <span class="symbol">::</span> <span class="type-name">Int</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Int</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Int</span>
rem x y <span class="symbol">=</span> %rem(x, y)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">mod <span class="symbol">::</span> <span class="type-name">Int</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Int</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Int</span>
mod x y <span class="symbol">=</span> rem (iadd y (rem x y)) y
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">neg <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">--o</span> <span class="type-name">Real</span>
neg x <span class="symbol">=</span> %fneg(x)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">fadd <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
fadd x y <span class="symbol">=</span> %fadd(x, y)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">fsub <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
fsub x y <span class="symbol">=</span> %fsub(x, y)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">fmul <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">--o</span> <span class="type-name">Real</span> <span class="symbol">--o</span> <span class="type-name">Real</span>
fmul x y <span class="symbol">=</span> %fmul(x, y)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">fdiv <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">--o</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
fdiv x y <span class="symbol">=</span> %fdiv(x, y)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">ipow <span class="symbol">::</span> <span class="type-name">Int</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Int</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Int</span>
ipow x y <span class="symbol">=</span> %pow(x, y)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">pow <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
pow x y <span class="symbol">=</span> %%pow(x, y)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">asint <span class="symbol">::</span> <span class="keyword">A </span>i<span class="symbol">::</span><span class="type-name">Ix</span><span class="symbol">.</span> i <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Int</span>
asint i <span class="symbol">=</span> %asint(i)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">asidx <span class="symbol">::</span> <span class="keyword">A </span>i<span class="symbol">::</span><span class="type-name">Ix</span><span class="symbol">.</span> <span class="type-name">Int</span> <span class="symbol">-</span><span class="symbol">&gt;</span> i
asidx i <span class="symbol">=</span> %asidx(i)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">real <span class="symbol">::</span> <span class="type-name">Int</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
real x <span class="symbol">=</span> %inttoreal(x)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">b2i <span class="symbol">::</span> <span class="type-name">Bool</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Int</span>
b2i x <span class="symbol">=</span> %booltoint(x)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">filter <span class="symbol">::</span> (a <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Bool</span>) <span class="symbol">-</span><span class="symbol">&gt;</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>a <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="keyword">E </span>m<span class="symbol">.</span> m<span class="symbol">=</span><span class="symbol">&gt;</span>a
filter f x <span class="symbol">=</span> %filter(f, x)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">not <span class="symbol">::</span> <span class="type-name">Bool</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Bool</span>
not x <span class="symbol">=</span> %not(x)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">and <span class="symbol">::</span> <span class="type-name">Bool</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Bool</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Bool</span>
and x y <span class="symbol">=</span> %and(x, y)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">or <span class="symbol">::</span> <span class="type-name">Bool</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Bool</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Bool</span>
or x y <span class="symbol">=</span> %or(x, y)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="comment">-- `todo` is like `undefined` in Haskell
</span></div></div><div class="cell"><div class="code-block"><span class="keyword">todo</span> <span class="symbol">::</span> a
<span class="keyword">todo</span> <span class="symbol">=</span> %<span class="keyword">todo</span>()
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="prose-block"><p>Wrappers around C library functions</p>
</div></div><div class="cell"><div class="code-block"><span class="symbol">@</span>primitive
exp <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
exp x <span class="symbol">=</span> %%exp(x)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="symbol">@</span>primitive
log <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
log x <span class="symbol">=</span> %%log(x)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="symbol">@</span>primitive
sqrt <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
sqrt x <span class="symbol">=</span> %%sqrt(x)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="symbol">@</span>primitive
sin <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
sin x <span class="symbol">=</span> %%sin(x)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="symbol">@</span>primitive
cos <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
cos x <span class="symbol">=</span> %%cos(x)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">tan <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
tan x <span class="symbol">=</span> %%tan(x)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">floor <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Int</span>
floor x <span class="symbol">=</span> %%floorDex(x)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="prose-block"><p>Misc functions</p>
</div></div><div class="cell"><div class="code-block">fst <span class="symbol">::</span> (a, b) <span class="symbol">--o</span> a
fst (x, y) <span class="symbol">=</span> x
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">snd <span class="symbol">::</span> (a, b) <span class="symbol">--o</span> b
snd (x, y) <span class="symbol">=</span> y
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="comment">-- Hope to need this less with linearity polymoprhism
</span></div></div><div class="cell"><div class="code-block">asNonLin <span class="symbol">::</span> (a <span class="symbol">--o</span> b) <span class="symbol">-</span><span class="symbol">&gt;</span> a <span class="symbol">-</span><span class="symbol">&gt;</span> b
asNonLin f x <span class="symbol">=</span> f x
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">b2r <span class="symbol">::</span> <span class="type-name">Bool</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
b2r x <span class="symbol">=</span> real <span class="symbol">$</span> b2i x
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">pi <span class="symbol">::</span> <span class="type-name">Real</span>
pi <span class="symbol">=</span> 3<span class="symbol">.</span>141592653589793
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">ixadd <span class="symbol">::</span> <span class="keyword">A </span>i<span class="symbol">::</span><span class="type-name">Ix</span><span class="symbol">.</span> i <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Int</span> <span class="symbol">-</span><span class="symbol">&gt;</span> i
ixadd i n <span class="symbol">=</span> asidx <span class="symbol">$</span> iadd (asint i) n
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">ixsub <span class="symbol">::</span> <span class="keyword">A </span>i<span class="symbol">::</span><span class="type-name">Ix</span><span class="symbol">.</span> i <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Int</span> <span class="symbol">-</span><span class="symbol">&gt;</span> i
ixsub i n <span class="symbol">=</span> asidx <span class="symbol">$</span> isub (asint i) n
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">iota <span class="symbol">::</span> n<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Int</span>
iota <span class="symbol">=</span> <span class="keyword">for</span> i<span class="symbol">.</span> asint i
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">id <span class="symbol">::</span> a <span class="symbol">-</span><span class="symbol">&gt;</span> a
id x <span class="symbol">=</span> x
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">dup <span class="symbol">::</span> a <span class="symbol">-</span><span class="symbol">&gt;</span> (a, a)
dup x <span class="symbol">=</span> (x, x)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">map <span class="symbol">::</span> (a <span class="symbol">-</span><span class="symbol">&gt;</span> b) <span class="symbol">-</span><span class="symbol">&gt;</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>a <span class="symbol">-</span><span class="symbol">&gt;</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>b
map f xs <span class="symbol">=</span> <span class="keyword">for</span> i<span class="symbol">.</span> f xs<span class="symbol">.</span>i
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">map2 <span class="symbol">::</span> (a <span class="symbol">-</span><span class="symbol">&gt;</span> b) <span class="symbol">-</span><span class="symbol">&gt;</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>m<span class="symbol">=</span><span class="symbol">&gt;</span>a <span class="symbol">-</span><span class="symbol">&gt;</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>m<span class="symbol">=</span><span class="symbol">&gt;</span>b
map2 f xs <span class="symbol">=</span> <span class="keyword">for</span> i j<span class="symbol">.</span> f xs<span class="symbol">.</span>i<span class="symbol">.</span>j
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">zip <span class="symbol">::</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>a <span class="symbol">-</span><span class="symbol">&gt;</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>b <span class="symbol">-</span><span class="symbol">&gt;</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>(a,b)
zip xs ys <span class="symbol">=</span> <span class="keyword">for</span> i<span class="symbol">.</span> (xs<span class="symbol">.</span>i, ys<span class="symbol">.</span>i)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">unzip <span class="symbol">::</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>(a, b) <span class="symbol">-</span><span class="symbol">&gt;</span> (n<span class="symbol">=</span><span class="symbol">&gt;</span>a, n<span class="symbol">=</span><span class="symbol">&gt;</span>b)
unzip xys <span class="symbol">=</span> (map (asNonLin fst) xys, map (asNonLin snd) xys)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">fanout <span class="symbol">::</span> <span class="keyword">A </span>n a<span class="symbol">.</span> a <span class="symbol">-</span><span class="symbol">&gt;</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>a
fanout x <span class="symbol">=</span> <span class="keyword">for</span> i<span class="symbol">.</span> x
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">sq <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
sq x <span class="symbol">=</span> x <span class="symbol">*</span> x
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">select <span class="symbol">::</span> <span class="keyword">A </span>a<span class="symbol">::</span><span class="type-name">Data</span><span class="symbol">.</span> <span class="type-name">Bool</span> <span class="symbol">-</span><span class="symbol">&gt;</span> a <span class="symbol">-</span><span class="symbol">&gt;</span> a <span class="symbol">-</span><span class="symbol">&gt;</span> a
select p x y <span class="symbol">=</span> %select(p, x, y)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">abs <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
abs x <span class="symbol">=</span> select (x <span class="symbol">&gt;</span> 0<span class="symbol">.</span>0) x (0<span class="symbol">.</span>0 <span class="symbol">-</span> x)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">compose <span class="symbol">::</span> (b <span class="symbol">-</span><span class="symbol">&gt;</span> c) <span class="symbol">-</span><span class="symbol">&gt;</span> (a <span class="symbol">-</span><span class="symbol">&gt;</span> b) <span class="symbol">-</span><span class="symbol">&gt;</span> a <span class="symbol">-</span><span class="symbol">&gt;</span> c
compose f g x <span class="symbol">=</span> f (g x)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">slice <span class="symbol">::</span> <span class="keyword">A </span>n m a <span class="symbol">.</span> m<span class="symbol">=</span><span class="symbol">&gt;</span>a <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Int</span> <span class="symbol">-</span><span class="symbol">&gt;</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>a
slice xs start <span class="symbol">=</span> <span class="keyword">for</span> i<span class="symbol">.</span> xs<span class="symbol">.</span>(asidx (asint i `iadd` start))
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="prose-block"><p>State-carrying loop constructs</p>
</div></div><div class="cell"><div class="code-block">scan <span class="symbol">::</span> <span class="keyword">A </span>n<span class="symbol">::</span><span class="type-name">Ix</span> a<span class="symbol">::</span><span class="type-name">Data</span> b <span class="symbol">.</span>  a <span class="symbol">-</span><span class="symbol">&gt;</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>(a<span class="symbol">-</span><span class="symbol">&gt;</span>(a, b)) <span class="symbol">-</span><span class="symbol">&gt;</span> (a, n<span class="symbol">=</span><span class="symbol">&gt;</span>b)
scan x0 fs <span class="symbol">=</span> %scan(x0, <span class="keyword">for</span> i<span class="symbol">.</span> <span class="keyword">lam</span> x<span class="symbol">.</span> fs<span class="symbol">.</span>i x)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">fold <span class="symbol">::</span> <span class="keyword">A </span>n<span class="symbol">::</span><span class="type-name">Ix</span> a<span class="symbol">::</span><span class="type-name">Data</span> <span class="symbol">.</span> a <span class="symbol">-</span><span class="symbol">&gt;</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>(a<span class="symbol">-</span><span class="symbol">&gt;</span>a) <span class="symbol">-</span><span class="symbol">&gt;</span> a
fold x0 fs <span class="symbol">=</span> fst <span class="symbol">$</span> scan x0 <span class="keyword">for</span> i<span class="symbol">.</span> <span class="keyword">lam</span> x<span class="symbol">.</span> (fs<span class="symbol">.</span>i x, ())
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="comment">-- TODO: call this `scan` and call the current `scan` something else
</span></div></div><div class="cell"><div class="code-block">scan&#39; <span class="symbol">::</span> <span class="keyword">A </span>n<span class="symbol">::</span><span class="type-name">Ix</span> a<span class="symbol">::</span><span class="type-name">Data</span> <span class="symbol">.</span> a <span class="symbol">-</span><span class="symbol">&gt;</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>(a<span class="symbol">-</span><span class="symbol">&gt;</span>a) <span class="symbol">-</span><span class="symbol">&gt;</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>a
scan&#39; x0 fs <span class="symbol">=</span> snd <span class="symbol">$</span> scan x0 <span class="keyword">for</span> i<span class="symbol">.</span> <span class="keyword">lam</span> x<span class="symbol">.</span> dup (fs<span class="symbol">.</span>i x)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">scanlin <span class="symbol">::</span> <span class="keyword">A </span>n<span class="symbol">::</span><span class="type-name">Ix</span> c<span class="symbol">::</span><span class="type-name">Data</span> a b <span class="symbol">.</span> (n <span class="symbol">=</span><span class="symbol">&gt;</span>((c,a) <span class="symbol">--o</span> (c,b))) <span class="symbol">-</span><span class="symbol">&gt;</span> (c, n<span class="symbol">=</span><span class="symbol">&gt;</span>a) <span class="symbol">--o</span> (c, n<span class="symbol">=</span><span class="symbol">&gt;</span>b)
scanlin fs (c0, xs) <span class="symbol">=</span> %scan(c0, <span class="keyword">for</span> i<span class="symbol">.</span> <span class="keyword">lam</span> c<span class="symbol">.</span> fs<span class="symbol">.</span>i (c, xs<span class="symbol">.</span>i) )
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">foldlin <span class="symbol">::</span> <span class="keyword">A </span>n<span class="symbol">::</span><span class="type-name">Ix</span> c<span class="symbol">::</span><span class="type-name">Data</span> a <span class="symbol">.</span> (n<span class="symbol">=</span><span class="symbol">&gt;</span>((c, a) <span class="symbol">--o</span> c)) <span class="symbol">-</span><span class="symbol">&gt;</span> (c, n<span class="symbol">=</span><span class="symbol">&gt;</span>a) <span class="symbol">--o</span> c
foldlin fs (c0, xs) <span class="symbol">=</span> fst <span class="symbol">$</span> scanlin (<span class="keyword">for</span> i<span class="symbol">.</span> <span class="keyword">llam</span> (c,x)<span class="symbol">.</span> (fs<span class="symbol">.</span>i (c, x), ())) (c0, xs)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="prose-block"><p>More misc functions</p>
</div></div><div class="cell"><div class="code-block">sum <span class="symbol">::</span> n<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span> <span class="symbol">--o</span> <span class="type-name">Real</span>
sum xs <span class="symbol">=</span> foldlin (<span class="keyword">for</span> _<span class="symbol">.</span> <span class="keyword">llam</span> (c,x)<span class="symbol">.</span> c <span class="symbol">+</span> x) (0<span class="symbol">.</span>0, xs)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">isum <span class="symbol">::</span> n<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Int</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Int</span>
isum xs <span class="symbol">=</span> fold 0 <span class="keyword">for</span> i<span class="symbol">.</span> x <span class="symbol">=</span> xs<span class="symbol">.</span>i<span class="symbol">;</span> <span class="keyword">lam</span> c<span class="symbol">.</span> iadd c x
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="comment">-- TODO: make this a builtin for efficiency
</span></div></div><div class="cell"><div class="code-block">size <span class="symbol">::</span> <span class="keyword">A </span>n<span class="symbol">::</span><span class="type-name">Ix</span><span class="symbol">.</span> <span class="type-name">Int</span>
size <span class="symbol">=</span> %idxSetSize(<span class="symbol">@</span>n)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">range <span class="symbol">::</span> <span class="type-name">Int</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="keyword">E </span>i<span class="symbol">.</span> ()
range n <span class="symbol">=</span> %range(n)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">mean <span class="symbol">::</span> <span class="keyword">A </span>n<span class="symbol">.</span> n<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span> <span class="symbol">--o</span> <span class="type-name">Real</span>
mean xs <span class="symbol">=</span> sum xs <span class="symbol">/</span> real (size <span class="symbol">@</span>n)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">std <span class="symbol">::</span> <span class="keyword">A </span>n<span class="symbol">.</span> n<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
std xs <span class="symbol">=</span> sqrt <span class="symbol">$</span> mean (map sq xs) <span class="symbol">-</span> sq (mean xs)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">linspace <span class="symbol">::</span> <span class="keyword">A </span>n<span class="symbol">.</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> n<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span>
linspace low high <span class="symbol">=</span> dx <span class="symbol">=</span> (high <span class="symbol">-</span> low) <span class="symbol">/</span> real (size <span class="symbol">@</span>n)
                    <span class="keyword">for</span> i<span class="symbol">::</span>n<span class="symbol">.</span> low <span class="symbol">+</span> real (asint i) <span class="symbol">*</span> dx
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="prose-block"><p>Functions for working with the pseudorandom number generator</p>
</div></div><div class="cell"><div class="code-block"><span class="keyword">newtype</span> <span class="type-name">Key</span> <span class="symbol">=</span> <span class="type-name">Int</span>
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">hash <span class="symbol">::</span> <span class="type-name">Key</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Int</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Key</span>
hash x y <span class="symbol">=</span> %%threefry2x32(x, y)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">newKey <span class="symbol">::</span> <span class="type-name">Int</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Key</span>
newKey x <span class="symbol">=</span> hash %newtypecast(0) x
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">splitKey <span class="symbol">::</span> <span class="type-name">Key</span> <span class="symbol">-</span><span class="symbol">&gt;</span> (<span class="type-name">Key</span>, <span class="type-name">Key</span>)
splitKey key <span class="symbol">=</span> (hash key 0, hash key 1)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">splitKey3 <span class="symbol">::</span> <span class="type-name">Key</span> <span class="symbol">-</span><span class="symbol">&gt;</span> (<span class="type-name">Key</span>, <span class="type-name">Key</span>, <span class="type-name">Key</span>)
splitKey3 key <span class="symbol">=</span>
  (k1, key&#39;) <span class="symbol">=</span> splitKey key
  (k2, k3) <span class="symbol">=</span> splitKey key&#39;
  (k1, k2, k3)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">many <span class="symbol">::</span> <span class="keyword">A </span>n a<span class="symbol">.</span> (<span class="type-name">Key</span> <span class="symbol">-</span><span class="symbol">&gt;</span> a) <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Key</span> <span class="symbol">-</span><span class="symbol">&gt;</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>a
many f key <span class="symbol">=</span> <span class="keyword">for</span> i<span class="symbol">.</span> f (hash key (asint i))
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">ixkey <span class="symbol">::</span> <span class="keyword">A </span>n<span class="symbol">::</span><span class="type-name">Ix</span><span class="symbol">.</span> <span class="type-name">Key</span> <span class="symbol">-</span><span class="symbol">&gt;</span> n <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Key</span>
ixkey x i <span class="symbol">=</span> hash x (asint i)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">rand <span class="symbol">::</span> <span class="type-name">Key</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
rand x <span class="symbol">=</span> %%randunif(x)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">randn <span class="symbol">::</span> <span class="type-name">Key</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
randn k <span class="symbol">=</span>
  (k1, k2) <span class="symbol">=</span> splitKey k
  u1 <span class="symbol">=</span> rand k1
  u2 <span class="symbol">=</span> rand k2
  sqrt (<span class="symbol">-</span>2<span class="symbol">.</span>0 <span class="symbol">*</span> log u1) <span class="symbol">*</span> cos (2<span class="symbol">.</span>0 <span class="symbol">*</span> pi <span class="symbol">*</span> u2)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">randIdx <span class="symbol">::</span> <span class="keyword">A </span>n<span class="symbol">::</span><span class="type-name">Ix</span><span class="symbol">.</span> <span class="type-name">Key</span> <span class="symbol">-</span><span class="symbol">&gt;</span> n
randIdx key <span class="symbol">=</span>
  unif <span class="symbol">=</span> rand key
  asidx <span class="symbol">$</span> floor <span class="symbol">$</span> unif <span class="symbol">*</span> real (size <span class="symbol">@</span>n)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="prose-block"><p>min / max etc</p>
</div></div><div class="cell"><div class="code-block">minby <span class="symbol">::</span> <span class="keyword">A </span>a<span class="symbol">::</span><span class="type-name">Data</span><span class="symbol">.</span> (a<span class="symbol">-</span><span class="symbol">&gt;</span><span class="type-name">Real</span>)<span class="symbol">-</span><span class="symbol">&gt;</span>a<span class="symbol">-</span><span class="symbol">&gt;</span>a<span class="symbol">-</span><span class="symbol">&gt;</span>a
minby f x y <span class="symbol">=</span> select ((f x) <span class="symbol">&lt;</span> (f y)) x y
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">min <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
min <span class="symbol">=</span> minby id
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">minimumby <span class="symbol">::</span> <span class="keyword">A </span>n a<span class="symbol">::</span><span class="type-name">Data</span><span class="symbol">.</span> (a<span class="symbol">-</span><span class="symbol">&gt;</span><span class="type-name">Real</span>)<span class="symbol">-</span><span class="symbol">&gt;</span>(n<span class="symbol">=</span><span class="symbol">&gt;</span>a)<span class="symbol">-</span><span class="symbol">&gt;</span>a
minimumby f xs <span class="symbol">=</span> fold xs<span class="symbol">.</span>(asidx 0) (<span class="keyword">for</span> i<span class="symbol">.</span> minby f xs<span class="symbol">.</span>i)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">minimum <span class="symbol">::</span> <span class="keyword">A </span>n<span class="symbol">.</span> (n<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span>)<span class="symbol">-</span><span class="symbol">&gt;</span><span class="type-name">Real</span>
minimum <span class="symbol">=</span> minimumby id
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">maxby <span class="symbol">::</span> <span class="keyword">A </span>a<span class="symbol">::</span><span class="type-name">Data</span><span class="symbol">.</span> (a<span class="symbol">-</span><span class="symbol">&gt;</span><span class="type-name">Real</span>)<span class="symbol">-</span><span class="symbol">&gt;</span>a<span class="symbol">-</span><span class="symbol">&gt;</span>a<span class="symbol">-</span><span class="symbol">&gt;</span>a
maxby f <span class="symbol">=</span> minby (asNonLin neg `compose` f)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">max <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
max x y <span class="symbol">=</span> maxby id x y
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">maximumby <span class="symbol">::</span> <span class="keyword">A </span>p q<span class="symbol">::</span><span class="type-name">Data</span><span class="symbol">.</span> (q<span class="symbol">-</span><span class="symbol">&gt;</span><span class="type-name">Real</span>)<span class="symbol">-</span><span class="symbol">&gt;</span>(p<span class="symbol">=</span><span class="symbol">&gt;</span>q)<span class="symbol">-</span><span class="symbol">&gt;</span>q
maximumby f <span class="symbol">=</span> minimumby (asNonLin neg `compose` f)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">maximum <span class="symbol">::</span> <span class="keyword">A </span>p<span class="symbol">.</span> (p<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span>)<span class="symbol">-</span><span class="symbol">&gt;</span><span class="type-name">Real</span>
maximum xs <span class="symbol">=</span> maximumby id xs
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">argmin <span class="symbol">::</span> n<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> n
argmin ds <span class="symbol">=</span> fst <span class="symbol">$</span> fold (asidx 0, ds<span class="symbol">.</span>(asidx 0)) <span class="keyword">for</span> i<span class="symbol">.</span> <span class="keyword">lam</span> (bestIx, bestDist)<span class="symbol">.</span>
               select (ds<span class="symbol">.</span>i <span class="symbol">&lt;</span> bestDist) (i, ds<span class="symbol">.</span>i) (bestIx, bestDist)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="prose-block"><p>Vector spaces and automatic differentiation.</p>
</div></div><div class="cell"><div class="code-block">vzero <span class="symbol">::</span> <span class="keyword">A </span>a<span class="symbol">::</span><span class="type-name">VS</span><span class="symbol">.</span> a
vzero <span class="symbol">=</span> %vzero()
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">vadd <span class="symbol">::</span> <span class="keyword">A </span>a<span class="symbol">::</span><span class="type-name">VS</span><span class="symbol">.</span> a <span class="symbol">-</span><span class="symbol">&gt;</span> a <span class="symbol">-</span><span class="symbol">&gt;</span> a
vadd x y <span class="symbol">=</span> %vadd(x, y)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">vsingle <span class="symbol">::</span> <span class="keyword">A </span>a<span class="symbol">::</span><span class="type-name">VS</span> n<span class="symbol">.</span> n <span class="symbol">-</span><span class="symbol">&gt;</span> a <span class="symbol">-</span><span class="symbol">&gt;</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>a
vsingle i x <span class="symbol">=</span> %vsingle(i, x)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">vsum <span class="symbol">::</span> <span class="keyword">A </span>a<span class="symbol">::</span><span class="type-name">VS</span> n<span class="symbol">.</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>a <span class="symbol">-</span><span class="symbol">&gt;</span> a
vsum xs <span class="symbol">=</span> %vsum(<span class="keyword">for</span> i<span class="symbol">.</span> xs<span class="symbol">.</span>i)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">linearize <span class="symbol">::</span> <span class="keyword">A </span>a<span class="symbol">::</span><span class="type-name">VS</span> b<span class="symbol">::</span><span class="type-name">VS</span><span class="symbol">.</span> (a <span class="symbol">-</span><span class="symbol">&gt;</span> b) <span class="symbol">-</span><span class="symbol">&gt;</span> a <span class="symbol">-</span><span class="symbol">&gt;</span> (b, a <span class="symbol">--o</span> b)
linearize f x0 <span class="symbol">=</span> %linearize(<span class="keyword">lam</span> x<span class="symbol">.</span> f x, x0)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">jvp <span class="symbol">::</span> <span class="keyword">A </span>a<span class="symbol">::</span><span class="type-name">VS</span> b<span class="symbol">::</span><span class="type-name">VS</span><span class="symbol">.</span> (a <span class="symbol">-</span><span class="symbol">&gt;</span> b) <span class="symbol">-</span><span class="symbol">&gt;</span> a <span class="symbol">-</span><span class="symbol">&gt;</span> a <span class="symbol">--o</span> b
jvp f x <span class="symbol">=</span> <span class="keyword">llam</span> t<span class="symbol">.</span> snd (linearize f x) t
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">transposeLinear <span class="symbol">::</span> <span class="keyword">A </span>a<span class="symbol">::</span><span class="type-name">VS</span> b<span class="symbol">::</span><span class="type-name">VS</span><span class="symbol">.</span> (a <span class="symbol">--o</span> b) <span class="symbol">--o</span> b <span class="symbol">--o</span> a
transposeLinear <span class="symbol">=</span> <span class="keyword">llam</span> f ct<span class="symbol">.</span> %linearTranspose(<span class="keyword">llam</span> t<span class="symbol">.</span> f t) ct
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">vjp <span class="symbol">::</span> <span class="keyword">A </span>a<span class="symbol">::</span><span class="type-name">VS</span> b<span class="symbol">::</span><span class="type-name">VS</span><span class="symbol">.</span> (a <span class="symbol">-</span><span class="symbol">&gt;</span> b) <span class="symbol">-</span><span class="symbol">&gt;</span> a <span class="symbol">-</span><span class="symbol">&gt;</span> (b, b <span class="symbol">--o</span> a)
vjp f x <span class="symbol">=</span> (y, df) <span class="symbol">=</span> linearize f x
          (y, transposeLinear df)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">grad <span class="symbol">::</span> <span class="keyword">A </span>a<span class="symbol">::</span><span class="type-name">VS</span><span class="symbol">.</span> (a <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>) <span class="symbol">-</span><span class="symbol">&gt;</span> a <span class="symbol">-</span><span class="symbol">&gt;</span> a
grad f x <span class="symbol">=</span> (_, pullback) <span class="symbol">=</span> vjp f x
           pullback 1<span class="symbol">.</span>0
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">deriv <span class="symbol">::</span> (<span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>) <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
deriv f x <span class="symbol">=</span> jvp f x 1<span class="symbol">.</span>0
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">derivRev <span class="symbol">::</span> (<span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>) <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
derivRev f x <span class="symbol">=</span> snd (vjp f x) 1<span class="symbol">.</span>0
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">checkDerivBase <span class="symbol">::</span> (<span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>) <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Bool</span>
checkDerivBase f x <span class="symbol">=</span>
  eps <span class="symbol">=</span> 1e<span class="symbol">-</span>5
  ansFwd  <span class="symbol">=</span> deriv    f x
  ansRev  <span class="symbol">=</span> derivRev f x
  ansNumeric <span class="symbol">=</span> (f (x <span class="symbol">+</span> eps) <span class="symbol">-</span> f (x <span class="symbol">-</span> eps)) <span class="symbol">/</span> (2<span class="symbol">.</span> <span class="symbol">*</span> eps)
  isClose a b <span class="symbol">=</span> abs (a <span class="symbol">-</span> b) <span class="symbol">&lt;</span> 1e<span class="symbol">-</span>3
  isClose ansFwd ansNumeric &amp;&amp; isClose ansRev ansNumeric
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">checkDeriv <span class="symbol">::</span> (<span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>) <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Bool</span>
checkDeriv f x <span class="symbol">=</span> checkDerivBase f x &amp;&amp; checkDerivBase (deriv f) x
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">forUnzip <span class="symbol">::</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>(b, a <span class="symbol">-</span><span class="symbol">&gt;</span> b) <span class="symbol">-</span><span class="symbol">&gt;</span> (n<span class="symbol">=</span><span class="symbol">&gt;</span>b, a <span class="symbol">-</span><span class="symbol">&gt;</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>b)
forUnzip xfs <span class="symbol">=</span> (xs, fs) <span class="symbol">=</span> unzip xfs
               (xs, <span class="keyword">lam</span> t<span class="symbol">.</span> <span class="keyword">for</span> i<span class="symbol">.</span> fs<span class="symbol">.</span>i t)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">sin<span class="symbol">#</span>lin <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> (<span class="type-name">Real</span>, <span class="type-name">Real</span> <span class="symbol">--o</span> <span class="type-name">Real</span>)
sin<span class="symbol">#</span>lin x <span class="symbol">=</span> (sin x, <span class="keyword">llam</span> t<span class="symbol">.</span> t <span class="symbol">*</span> cos x)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">cos<span class="symbol">#</span>lin <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> (<span class="type-name">Real</span>, <span class="type-name">Real</span> <span class="symbol">--o</span> <span class="type-name">Real</span>)
cos<span class="symbol">#</span>lin x <span class="symbol">=</span> (cos x, <span class="keyword">llam</span> t<span class="symbol">.</span> t <span class="symbol">*</span> (neg (sin x)))
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">exp<span class="symbol">#</span>lin <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> (<span class="type-name">Real</span>, <span class="type-name">Real</span> <span class="symbol">--o</span> <span class="type-name">Real</span>)
exp<span class="symbol">#</span>lin x <span class="symbol">=</span>
  ans <span class="symbol">=</span> exp x
  (ans, <span class="keyword">llam</span> t<span class="symbol">.</span> t <span class="symbol">*</span> ans)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">log<span class="symbol">#</span>lin <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> (<span class="type-name">Real</span>, <span class="type-name">Real</span> <span class="symbol">--o</span> <span class="type-name">Real</span>)
log<span class="symbol">#</span>lin x <span class="symbol">=</span> (log x, <span class="keyword">llam</span> t<span class="symbol">.</span> t <span class="symbol">/</span> x)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">sqrt<span class="symbol">#</span>lin <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> (<span class="type-name">Real</span>, <span class="type-name">Real</span> <span class="symbol">--o</span> <span class="type-name">Real</span>)
sqrt<span class="symbol">#</span>lin x <span class="symbol">=</span>
  ans <span class="symbol">=</span> sqrt x
  (ans, <span class="keyword">llam</span> t<span class="symbol">.</span> 0<span class="symbol">.</span>5 <span class="symbol">*</span> t <span class="symbol">/</span> ans)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="prose-block"><p>Some general linear algebra routines.</p>
</div></div><div class="cell"><div class="code-block">vdot <span class="symbol">::</span> n<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> n<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
vdot x y <span class="symbol">=</span> sum <span class="keyword">for</span> i<span class="symbol">.</span> x<span class="symbol">.</span>i <span class="symbol">*</span> y<span class="symbol">.</span>i
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">mmp <span class="symbol">::</span> l<span class="symbol">=</span><span class="symbol">&gt;</span>m<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> m<span class="symbol">=</span><span class="symbol">&gt;</span>n<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> l<span class="symbol">=</span><span class="symbol">&gt;</span>n<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span>
mmp m1 m2 <span class="symbol">=</span> <span class="keyword">for</span> i k<span class="symbol">.</span> sum <span class="keyword">for</span> j<span class="symbol">.</span> m1<span class="symbol">.</span>i<span class="symbol">.</span>j <span class="symbol">*</span> m2<span class="symbol">.</span>j<span class="symbol">.</span>k
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">mvp <span class="symbol">::</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>m<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> m<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> n<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span>
mvp m v <span class="symbol">=</span> <span class="keyword">for</span> i<span class="symbol">.</span> vdot m<span class="symbol">.</span>i v
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">transpose <span class="symbol">::</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>m<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> m<span class="symbol">=</span><span class="symbol">&gt;</span>n<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span>
transpose x <span class="symbol">=</span> <span class="keyword">for</span> i j<span class="symbol">.</span> x<span class="symbol">.</span>j<span class="symbol">.</span>i
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">inner <span class="symbol">::</span> n<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> n<span class="symbol">=</span><span class="symbol">&gt;</span>m<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> m<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
inner x m y <span class="symbol">=</span> sum <span class="keyword">for</span> (i,j)<span class="symbol">.</span> x<span class="symbol">.</span>i <span class="symbol">*</span> m<span class="symbol">.</span>i<span class="symbol">.</span>j <span class="symbol">*</span> y<span class="symbol">.</span>j
</div></div></div></body></html>