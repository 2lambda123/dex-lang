<!DOCTYPE HTML>
<html><head><link rel="stylesheet" href="style.css" type="text/css"><meta charset="UTF-8"></head><body><div id="main-output"><div class="cell"><div class="code-block"><span class="command">:p</span> f <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
   f x <span class="symbol">=</span> x
   jvp f 3<span class="symbol">.</span>0 2<span class="symbol">.</span>0
</div><div class="result-block">2.0</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> f x <span class="symbol">=</span> x <span class="symbol">*</span> x
   jvp f 3<span class="symbol">.</span>0 1<span class="symbol">.</span>5
</div><div class="result-block">9.0</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> f x <span class="symbol">=</span> x <span class="symbol">+</span> x
   jvp f 3<span class="symbol">.</span>0 2<span class="symbol">.</span>0
</div><div class="result-block">4.0</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> f x <span class="symbol">=</span> x <span class="symbol">*</span> x <span class="symbol">*</span> x
   jvp f 2<span class="symbol">.</span>0 1<span class="symbol">.</span>5
</div><div class="result-block">18.0</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> f x <span class="symbol">=</span> x <span class="symbol">*</span> x <span class="symbol">*</span> x
   jvp (<span class="keyword">lam</span> x<span class="symbol">.</span> jvp f x 1<span class="symbol">.</span>0) 2<span class="symbol">.</span>0 1<span class="symbol">.</span>0
</div><div class="result-block">12.0</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> f x <span class="symbol">=</span> 4<span class="symbol">.</span>0 <span class="symbol">*</span> x <span class="symbol">*</span> x <span class="symbol">*</span> x
   deriv (deriv (deriv f)) 1<span class="symbol">.</span>234
</div><div class="result-block">24.0</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> f <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">--o</span> <span class="type-name">Real</span>
   f x <span class="symbol">=</span> x
   transposeLinear f 2<span class="symbol">.</span>0
</div><div class="result-block">2.0</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> f <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">--o</span> <span class="type-name">Real</span>
   f x <span class="symbol">=</span> x <span class="symbol">+</span> x
   transposeLinear f 1<span class="symbol">.</span>0
</div><div class="result-block">2.0</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> f <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">--o</span> <span class="type-name">Real</span>
   f x <span class="symbol">=</span> x <span class="symbol">+</span> (x <span class="symbol">+</span> x) <span class="symbol">*</span> 2<span class="symbol">.</span>0
   transposeLinear f 1<span class="symbol">.</span>0
</div><div class="result-block">5.0</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> f <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">--o</span> <span class="type-name">Real</span>
   f x <span class="symbol">=</span> x <span class="symbol">*</span> 2<span class="symbol">.</span>0
   transposeLinear f 1<span class="symbol">.</span>0
</div><div class="result-block">2.0</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> f <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">--o</span> <span class="type-name">Real</span>
   f x <span class="symbol">=</span> 2<span class="symbol">.</span>0 <span class="symbol">*</span> x
   transposeLinear f 1<span class="symbol">.</span>0
</div><div class="result-block">2.0</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> f <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">--o</span> (<span class="type-name">Real</span>, <span class="type-name">Real</span>)
   f x <span class="symbol">=</span> (x, 2<span class="symbol">.</span>0 <span class="symbol">*</span> x)
   transposeLinear f (1<span class="symbol">.</span>0, 3<span class="symbol">.</span>0)
</div><div class="result-block">7.0</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> f <span class="symbol">::</span> (<span class="type-name">Real</span>, <span class="type-name">Real</span>) <span class="symbol">--o</span> <span class="type-name">Real</span>
   f (x,y) <span class="symbol">=</span> x <span class="symbol">+</span> 2<span class="symbol">.</span>0 <span class="symbol">*</span> y
   transposeLinear f 1<span class="symbol">.</span>0
</div><div class="result-block">(1.0, 2.0)</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> grad (<span class="keyword">lam</span> x<span class="symbol">.</span> x <span class="symbol">*</span> x) 1<span class="symbol">.</span>0
</div><div class="result-block">2.0</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> deriv cos 0<span class="symbol">.</span>0
</div><div class="result-block">0.0</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> deriv sin 0<span class="symbol">.</span>0
</div><div class="result-block">1.0</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> (sin 1<span class="symbol">.</span>0, deriv (deriv sin) 1<span class="symbol">.</span>0)
</div><div class="result-block">(0.84147096, -0.84147096)</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> (cos 1<span class="symbol">.</span>0, deriv (deriv (deriv sin)) 1<span class="symbol">.</span>0)
</div><div class="result-block">(0.5403023, -0.5403023)</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> checkDeriv sin 1<span class="symbol">.</span>0
</div><div class="result-block">True</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> checkDeriv cos 1<span class="symbol">.</span>0
</div><div class="result-block">True</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> checkDeriv exp 2<span class="symbol">.</span>0
</div><div class="result-block">True</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> checkDeriv log 2<span class="symbol">.</span>0
</div><div class="result-block">True</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> checkDeriv sqrt 2<span class="symbol">.</span>0
</div><div class="result-block">True</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> checkDeriv (<span class="keyword">lam</span> x<span class="symbol">.</span> cos (sin (exp x))) 2<span class="symbol">.</span>0
</div><div class="result-block">True</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> checkDeriv (deriv sin) 1<span class="symbol">.</span>0
</div><div class="result-block">True</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> checkDeriv (deriv cos) 1<span class="symbol">.</span>0
</div><div class="result-block">True</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> deriv (fdiv 3<span class="symbol">.</span>0) 2<span class="symbol">.</span>0
</div><div class="result-block">-0.75</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> deriv (<span class="keyword">lam</span> x<span class="symbol">.</span> x <span class="symbol">/</span> 2<span class="symbol">.</span>0) 3<span class="symbol">.</span>0
</div><div class="result-block">0.5</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="symbol">@</span>primitive
badDerivFun <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
badDerivFun x <span class="symbol">=</span> x
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">badDerivFun<span class="symbol">#</span>lin <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> (<span class="type-name">Real</span>, <span class="type-name">Real</span> <span class="symbol">--o</span> <span class="type-name">Real</span>)
badDerivFun<span class="symbol">#</span>lin x <span class="symbol">=</span> (x, <span class="keyword">llam</span> t<span class="symbol">.</span> 2<span class="symbol">.</span> <span class="symbol">*</span> t)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> checkDeriv badDerivFun 1<span class="symbol">.</span>0
</div><div class="result-block">False</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="comment">-- Perturbation confusion test suggested by Barak Pearlmutter
</span></div></div><div class="cell"><div class="code-block"><span class="comment">-- https://github.com/HIPS/autograd/issues/4
</span></div></div><div class="cell"><div class="code-block"><span class="command">:p</span> deriv (<span class="keyword">lam</span> x<span class="symbol">.</span> x <span class="symbol">*</span> deriv (<span class="keyword">lam</span> y<span class="symbol">.</span> x <span class="symbol">*</span> y) 2<span class="symbol">.</span>0) 1<span class="symbol">.</span>0
</div><div class="result-block">2.0</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">sinn<span class="symbol">#</span>lin <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
sinn<span class="symbol">#</span>lin x <span class="symbol">=</span> x
</div><div class="err-block">Error: variable not in scope: sinn</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="symbol">@</span>primitive
newprim <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
newprim x <span class="symbol">=</span> x
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">newprim<span class="symbol">#</span>lin <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> <span class="type-name">Real</span>
newprim<span class="symbol">#</span>lin x <span class="symbol">=</span> x
</div><div class="err-block">Type error:Annotation should have type: (Real -&gt; (Real, (Real --o Real)))</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">deriv newprim 1<span class="symbol">.</span>0
</div><div class="err-block">Not implemented: linearization for newprim</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> f <span class="symbol">::</span> 3<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span> <span class="symbol">-</span><span class="symbol">&gt;</span> 3<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span>
   f x <span class="symbol">=</span> <span class="keyword">for</span> i<span class="symbol">.</span> sq x<span class="symbol">.</span>i
   jvp f [1<span class="symbol">.</span>0, 2<span class="symbol">.</span>0, 3<span class="symbol">.</span>0] [1<span class="symbol">.</span>0, 10<span class="symbol">.</span>0, 100<span class="symbol">.</span>0]
</div><div class="result-block">[2.0, 40.0, 600.0]</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> jvp (asNonLin sum) [1<span class="symbol">.</span>0, 2<span class="symbol">.</span>0, 3<span class="symbol">.</span>0] [1<span class="symbol">.</span>0, 2<span class="symbol">.</span>0, 3<span class="symbol">.</span>0]
</div><div class="result-block">6.0</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> f <span class="symbol">::</span> (<span class="type-name">Real</span>, 3<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span>) <span class="symbol">-</span><span class="symbol">&gt;</span> (<span class="type-name">Real</span>, 3<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span>)
   f (x0, xs) <span class="symbol">=</span> scan x0 <span class="keyword">for</span> i<span class="symbol">.</span> <span class="keyword">lam</span> c<span class="symbol">.</span> (c <span class="symbol">*</span> 2<span class="symbol">.</span>0, c <span class="symbol">*</span> xs<span class="symbol">.</span>i)
   jvp f (10<span class="symbol">.</span>0, [1<span class="symbol">.</span>, 2<span class="symbol">.</span>, 3<span class="symbol">.</span>]) (10<span class="symbol">.</span>0, [1<span class="symbol">.</span>, 2<span class="symbol">.</span>, 3<span class="symbol">.</span>])
</div><div class="result-block">(80.0, [20.0, 80.0, 240.0])</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> transposeLinear (<span class="keyword">llam</span> xs<span class="symbol">.</span> xs<span class="symbol">.</span>(1<span class="symbol">@</span>3)) 1<span class="symbol">.</span>5
</div><div class="result-block">[0.0, 1.5, 0.0]</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> transposeLinear (<span class="keyword">llam</span> xs<span class="symbol">.</span> xs<span class="symbol">.</span>(0<span class="symbol">@</span>3)<span class="symbol">.</span>(1<span class="symbol">@</span>2)) 1<span class="symbol">.</span>5
</div><div class="result-block">[[0.0, 1.5], [0.0, 0.0], [0.0, 0.0]]</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> transposeLinear (<span class="keyword">llam</span> xs<span class="symbol">.</span> <span class="keyword">for</span> i<span class="symbol">.</span> xs<span class="symbol">.</span>i) [1<span class="symbol">.</span>, 2<span class="symbol">.</span>, 3<span class="symbol">.</span>]
</div><div class="result-block">[1.0, 2.0, 3.0]</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> transposeLinear (sum <span class="symbol">@</span>4) 1<span class="symbol">.</span>5
</div><div class="result-block">[1.5, 1.5, 1.5, 1.5]</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">myscan <span class="symbol">::</span> (<span class="type-name">Real</span>, n<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span>) <span class="symbol">--o</span> (<span class="type-name">Real</span>, n<span class="symbol">=</span><span class="symbol">&gt;</span><span class="type-name">Real</span>)
myscan (c0, xs) <span class="symbol">=</span> scanlin (<span class="keyword">for</span> _<span class="symbol">.</span> <span class="keyword">llam</span> (x, y)<span class="symbol">.</span> (y, x)) (c0, xs)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">cs <span class="symbol">=</span> [1<span class="symbol">.</span>0, 2<span class="symbol">.</span>0, 3<span class="symbol">.</span>0]
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> transposeLinear (<span class="keyword">llam</span> xs<span class="symbol">.</span> <span class="keyword">for</span> i<span class="symbol">.</span> xs<span class="symbol">.</span>i <span class="symbol">*</span> cs<span class="symbol">.</span>i) [1<span class="symbol">.</span>0, 10<span class="symbol">.</span>0, 100<span class="symbol">.</span>0]
</div><div class="result-block">[1.0, 20.0, 300.0]</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> transposeLinear myscan (2<span class="symbol">.</span>0, [3<span class="symbol">.</span>0, 4<span class="symbol">.</span>0])
</div><div class="result-block">(3.0, [4.0, 2.0])</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">cs1 <span class="symbol">=</span> [0<span class="symbol">.</span>0, 1<span class="symbol">.</span>0]
</div></div><div class="cell"><div class="code-block">cs2 <span class="symbol">=</span> [1<span class="symbol">.</span>0, 0<span class="symbol">.</span>0]
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">myNonCommutingFold <span class="symbol">::</span> <span class="type-name">Real</span> <span class="symbol">--o</span> <span class="type-name">Real</span>
myNonCommutingFold y0 <span class="symbol">=</span>
  fst <span class="symbol">$</span> foldlin (<span class="keyword">for</span> i<span class="symbol">.</span> <span class="keyword">llam</span> ((x, y), ())<span class="symbol">.</span> (cs1<span class="symbol">.</span>i <span class="symbol">*</span> x <span class="symbol">+</span> cs2<span class="symbol">.</span>i <span class="symbol">*</span> y, 0<span class="symbol">.</span>0)) <span class="symbol">$</span>
                ((0<span class="symbol">.</span>0, y0), <span class="keyword">for</span> _<span class="symbol">.</span> ())
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> myNonCommutingFold 2<span class="symbol">.</span>0
</div><div class="result-block">2.0</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> transposeLinear myNonCommutingFold 2<span class="symbol">.</span>0
</div><div class="result-block">2.0</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> vadd 1<span class="symbol">.</span> 2<span class="symbol">.</span>
</div><div class="result-block">3.0</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> vadd (1<span class="symbol">.</span>,2<span class="symbol">.</span>) (3<span class="symbol">.</span>,4<span class="symbol">.</span>)
</div><div class="result-block">(4.0, 6.0)</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> vadd [1<span class="symbol">.</span>,2<span class="symbol">.</span>] [3<span class="symbol">.</span>,4<span class="symbol">.</span>]
</div><div class="result-block">[4.0, 6.0]</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> vzero <span class="symbol">@</span><span class="type-name">Real</span>
</div><div class="result-block">0.0</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> vzero <span class="symbol">@</span>(<span class="type-name">Real</span>, <span class="type-name">Real</span>)
</div><div class="result-block">(0.0, 0.0)</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:p</span> vzero <span class="symbol">@</span>(<span class="type-name">Real</span>, 3<span class="symbol">=</span><span class="symbol">&gt;</span>(<span class="type-name">Real</span>, <span class="type-name">Real</span>))
</div><div class="result-block">(0.0, [(0.0, 0.0), (0.0, 0.0), (0.0, 0.0)])</div></div></div></body></html>